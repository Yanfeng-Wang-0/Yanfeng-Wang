# **HPC Coursework - Stochastic Demographic and Neutral Models**

## **üìå Project Overview**
- **Author**: Yanfeng Wang (yw4524@ic.ac.uk)  
- **Course**: CMEE 2024 High-Performance Computing  
- **Date**: March 2025  
- **Description**: This project involves implementing **stochastic demographic population models** and **ecological neutral theory models** in R, running large-scale simulations on an HPC cluster, and analyzing the results. The coursework consists of deterministic and stochastic simulations, HPC parallel processing, and multiple challenge questions.

---

## **üìÅ File Structure**
All files are placed in a **single folder**.

| **File** | **Description** |
|----------|----------------|
| `Demographic.R` | Contains functions for deterministic and stochastic demographic population models. |
| `yw4524_HPC_2024_main.R` | Main script defining functions for population simulations. |
| `yw4524_HPC_2024_demographic_cluster.R` | Runs demographic model simulations on the HPC cluster. |
| `yw4524_HPC_2024_neutral_cluster.R` | Runs neutral model simulations on the HPC cluster. |
| `yw4524_HPC_2024_test.R` | Debugging and testing script for local verification. |
| `run_demographic_cluster_23.sh` | Submits a demographic model job to the HPC cluster. |
| `Demographic_cluster_script.sh` | Script for running neutral model simulations. |
| `question_1.png`, `question_2.png`, ..., `Challenge_D.png` | Output plots from simulations. |
| `demographic_cluster_*.rda`, `neutral_cluster_output_*.rda` | Data files generated by HPC runs. |

---

## **üìå How to Run the Code**

### **üîπ Running Locally (RStudio)**
1. Ensure R is installed with the necessary packages (`ggplot2`).
2. Load the main script:
   ```r
   source("yw4524_HPC_2024_main.R")
   ```
3. Run specific functions:
   ```r
   question_1()
   question_2()
   ```

### **üîπ Running on HPC Cluster**
#### **(1) Submit Demographic Model Job**
```bash
qsub Demographic_cluster_script.sh
```
#### **(2) Submit Neutral Model Job**
```bash
qsub run_demographic_cluster_23.sh
```
#### **(3) Monitor Job Status**
```bash
qstat -u yw4524
```
#### **(4) Retrieve Results**
```bash
sftp yw4524@hpc-cluster
get demographic_cluster_1.rda
```

---

## **üìå Expected Output**
| **Question** | **Output File** | **Description** |
|-------------|---------------|----------------|
| Question 1 | `question_1.png` | Deterministic growth of populations |
| Question 2 | `question_2.png` | Stochastic simulation results |
| Question 5 | `question_5.png` | Extinction probability comparison |
| Question 6 | `question_6.png` | Deviation of stochastic vs deterministic models |
| Question 14 | `question_14.png` | Species richness over time (neutral model) |
| Question 18 | `question_18.png` | Speciation effects in neutral model |
| Question 22 | `question_22.png` | Species abundance distribution after 2000 generations |
| Challenge A | `Challenge_A.png` | Population dynamics across conditions |
| Challenge B | `Challenge_B.png` | Mean species richness with 97.2% CI |
| Challenge C | `Challenge_C.png` | Mean species richness across different initial conditions |
| Challenge D | `Challenge_D.png` | Equilibrium dynamics over large time scales |
| Neutral Cluster Plot | `plot_neutral_cluster_results.png` | Average species abundance distribution for different community sizes |

---

## **üìå Notes and Assumptions**
- The **main script (`yw4524_HPC_2024_main.R`)** defines functions **but does not execute simulations directly**.
- **HPC runs** require submitting the `.sh` scripts to the cluster.
- **Ensure all `.rda` files** generated on HPC are saved before submission.
- **Avoid clearing the workspace** (`rm(list=ls())`) in `main.R`, as required by coursework guidelines.

---

## **üìå Troubleshooting**
- If a function doesn‚Äôt run:
  ```r
  debug(question_2)
  ```
- If an HPC job crashes:
  ```bash
  cat run_demographic_cluster_23.e12345  # Check error logs
  ```